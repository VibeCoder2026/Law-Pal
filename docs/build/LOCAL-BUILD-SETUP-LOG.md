# Local Android Dev Build Setup Log

**Date:** January 1, 2026
**Purpose:** Enable instant hot-reload development (2-3 sec testing vs 15 min EAS builds)

---

## Prerequisites Installed

### 1. Java Development Kit (JDK)
- **Version:** OpenJDK 21.0.8
- **Download:** https://adoptium.net/temurin/releases/?version=21
- **Verification:**
  ```bash
  java -version
  # Output: openjdk version "21.0.8" 2025-07-15
  ```

### 2. Android SDK
- **Location:** `C:\Users\keoma\AppData\Local\Android\Sdk`
- **Installed via:** Android Studio
- **Components:**
  - ‚úÖ platform-tools (includes adb)
  - ‚úÖ emulator
  - ‚úÖ build-tools
  - ‚úÖ platforms (Android API levels)

---

## Environment Variables Configured

### ANDROID_HOME
```powershell
setx ANDROID_HOME "C:\Users\keoma\AppData\Local\Android\Sdk"
```

### PATH Additions
```powershell
setx PATH "$env:PATH;C:\Users\keoma\AppData\Local\Android\Sdk\platform-tools;C:\Users\keoma\AppData\Local\Android\Sdk\emulator"
```

### Verification Commands
```powershell
# Check ANDROID_HOME (run in NEW terminal after setx)
echo $env:ANDROID_HOME

# Check ADB is accessible
adb version
# Expected: Android Debug Bridge version 1.0.41

# Check emulator (if using AVD)
emulator -list-avds
```

### Temporary Session Setup (if terminal not restarted)
```powershell
$env:ANDROID_HOME = "C:\Users\keoma\AppData\Local\Android\Sdk"
$env:PATH = "$env:PATH;C:\Users\keoma\AppData\Local\Android\Sdk\platform-tools;C:\Users\keoma\AppData\Local\Android\Sdk\emulator"
```

---

## First Local Build Process

### Command Used
```bash
cd C:\Users\keoma\constitution-reader
npx expo run:android
```

### What Happens During First Build
1. **Prebuild Phase** (~2-5 min)
   - Generates `android/` folder with native code
   - Applies Expo config plugins
   - Runs `plugins/withLawSourcesAssets.js` to configure PDF copying

2. **Gradle Sync** (~5-10 min)
   - Downloads Gradle wrapper
   - Downloads Android dependencies (~2GB)
   - Syncs project structure

3. **PDF Asset Copy** (~5 min)
   - Gradle task `copyLawSources` runs (from our plugin)
   - Copies `law_sources/` (761MB) ‚Üí `android/app/src/main/assets/law_sources/`
   - Preserves subdirectory structure (civil-law/, criminal-justice/, etc.)

4. **Compile React Native** (~10-15 min)
   - Compiles JavaScript bundle
   - Compiles native modules (react-native-pdf, expo-sqlite, etc.)
   - Generates APK

5. **Install & Launch** (~2-5 min)
   - Installs APK on connected device/emulator
   - Launches app automatically
   - Shows dev client splash screen

### Expected Total Time
- **First build:** 30-60 minutes
- **Subsequent builds (if needed):** 5-10 minutes (Gradle cache exists)

---

## Files Generated by Local Build

### android/ Directory Structure
```
android/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/assets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ law_sources/          # 761MB PDFs (copied by Gradle)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ civil-law/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ criminal-justice/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ... (all 459 Acts)
‚îÇ   ‚îú‚îÄ‚îÄ build/                    # Compiled APK (~1GB, can delete)
‚îÇ   ‚îî‚îÄ‚îÄ build.gradle              # Modified by withLawSourcesAssets.js
‚îú‚îÄ‚îÄ gradle/                       # Gradle wrapper
‚îî‚îÄ‚îÄ build/                        # Build cache (~500MB)
```

### Disk Space Used
- `android/`: ~500MB (native code)
- `android/app/src/main/assets/law_sources/`: 761MB (PDFs)
- `android/app/build/`: ~1GB (build artifacts, can clean)
- `android/.gradle/`: ~2GB (Gradle cache)
- **Total: ~4.3GB**

### Cleaning Build Cache (if needed)
```bash
cd android
./gradlew clean  # Removes build/ folders (~1GB freed)
cd ..
```

---

## Daily Development Workflow

### Starting Metro Bundler
```bash
cd C:\Users\keoma\constitution-reader
npx expo start --dev-client
```

**Output:**
```
‚Ä∫ Metro waiting on exp://192.168.x.x:8081
‚Ä∫ Scan the QR code above with Expo Go (Android) or the Camera app (iOS)

‚Ä∫ Press a ‚îÇ open Android
‚Ä∫ Press w ‚îÇ open web

‚Ä∫ Press j ‚îÇ open debugger
‚Ä∫ Press r ‚îÇ reload app
‚Ä∫ Press m ‚îÇ toggle menu
‚Ä∫ Press ? ‚îÇ show all commands
```

### Opening App on Device
1. **If app already installed:** Just tap "Law Pal GY (dev)" icon
2. **Or press 'a' in Metro:** Opens app automatically

### Hot Reload Workflow
```typescript
// 1. Edit any TypeScript/JavaScript file
src/screens/ChatScreen.tsx
src/services/AIService.ts
src/components/AnyComponent.tsx

// 2. Save file (Ctrl+S)

// 3. App updates in 2-3 seconds ‚ö°
```

### What Hot-Reloads Instantly
- ‚úÖ React components
- ‚úÖ TypeScript/JavaScript code
- ‚úÖ Styles (StyleSheet)
- ‚úÖ Navigation changes
- ‚úÖ Database queries
- ‚úÖ AIService logic
- ‚úÖ Theme changes
- ‚úÖ Constants and configs

### What Requires Rebuild
- ‚ùå New native npm packages (e.g., `npm install @react-native-voice/voice`)
- ‚ùå Changes to `app.json` plugins
- ‚ùå Adding new PDFs to `law_sources/`
- ‚ùå Expo SDK version updates
- ‚ùå Native code modifications

---

## Comparison: EAS vs Local Dev

### EAS Cloud Build (Production)
```bash
npx eas build --profile production --platform android
```

**Use for:**
- Weekly/monthly releases
- Play Store submissions
- Sharing APK with testers
- Clean production builds

**Timeline:**
- Upload: 5-10 min (1.5GB)
- Build: 10 min
- Download: 2 min
- **Total per change: ~15-20 min**

### Local Dev Build (Development)
```bash
# First time only (30-60 min):
npx expo run:android

# Daily usage:
npx expo start --dev-client
# Make changes ‚Üí Hot reload in 2-3 sec ‚ö°
```

**Use for:**
- 99% of development work
- Testing features
- UI tweaks
- Bug fixes
- Rapid iteration

**Timeline:**
- First build: 30-60 min (one-time)
- Code changes: **2-3 seconds** ‚ö°
- No rebuilding needed!

---

## Device Connection Options

### Option 1: USB Phone
```bash
# 1. Enable Developer Options on phone
# Settings ‚Üí About ‚Üí Tap "Build Number" 7 times

# 2. Enable USB Debugging
# Settings ‚Üí Developer Options ‚Üí USB Debugging

# 3. Connect via USB

# 4. Verify connection
adb devices
# Should show: <device-id>  device
```

### Option 2: Android Emulator (AVD)
```bash
# 1. Open Android Studio ‚Üí Device Manager
# 2. Create/start emulator

# 3. Verify emulator is running
adb devices
# Should show: emulator-5554  device

# Or start from command line:
emulator -list-avds
emulator -avd <emulator-name>
```

### Option 3: Wireless ADB (WiFi)
```bash
# 1. Connect phone via USB first
adb devices

# 2. Enable TCP/IP mode
adb tcpip 5555

# 3. Find phone's IP address
# Settings ‚Üí About ‚Üí Status ‚Üí IP Address

# 4. Disconnect USB, then connect via WiFi
adb connect 192.168.1.XXX:5555

# 5. Verify
adb devices
# Should show: 192.168.1.XXX:5555  device
```

---

## Troubleshooting

### "ANDROID_HOME not set"
```bash
# Check if set:
echo $env:ANDROID_HOME

# If empty, set permanently:
setx ANDROID_HOME "C:\Users\keoma\AppData\Local\Android\Sdk"

# Or temporarily (current session):
$env:ANDROID_HOME = "C:\Users\keoma\AppData\Local\Android\Sdk"

# Restart terminal and verify
```

### "adb: command not found"
```bash
# Add to PATH permanently:
setx PATH "$env:PATH;C:\Users\keoma\AppData\Local\Android\Sdk\platform-tools"

# Or temporarily:
$env:PATH = "$env:PATH;C:\Users\keoma\AppData\Local\Android\Sdk\platform-tools"

# Restart terminal and verify:
adb version
```

### "No devices found"
```bash
# Check connection:
adb devices

# If empty, troubleshoot:
# 1. USB cable connected?
# 2. USB debugging enabled?
# 3. Trust popup accepted on phone?
# 4. Try different USB port
# 5. Restart adb server:
adb kill-server
adb start-server
adb devices
```

### Build Fails - "Out of Memory"
```bash
# Increase Gradle heap size
# Edit: android/gradle.properties
# Add:
org.gradle.jvmargs=-Xmx4096m
```

### Build Fails - "PDFs not found"
```bash
# Check if plugin ran:
ls android/app/src/main/assets/law_sources

# If empty, rebuild:
npx expo prebuild --clean
npx expo run:android
```

### Metro Bundler Connection Issues
```bash
# 1. Check Metro is running:
npx expo start --dev-client

# 2. Ensure device on same WiFi network

# 3. Or use USB reverse:
adb reverse tcp:8081 tcp:8081

# 4. Shake device ‚Üí "Reload" or press 'r' in Metro
```

### App Won't Install
```bash
# Uninstall old version:
adb uninstall com.lawpalgy.app

# Rebuild and install:
npx expo run:android
```

---

## Testing the Setup

### After First Build Completes

1. **App Opens Automatically**
   - Should see "Law Pal GY" splash screen
   - App loads with Constitution and Acts

2. **Test PDF Viewing**
   - Navigate to Library ‚Üí Acts
   - Open any Act
   - PDF should load from `android/assets/`

3. **Test AI Chat**
   - Tap "Chat" on Home screen
   - Ask: "What are my rights under Article 40?"
   - Should get Gemini response with citations

4. **Test Hot Reload**
   ```typescript
   // Edit src/screens/HomeScreen.tsx
   // Change welcome text

   // Save file
   // App should update in 2-3 seconds
   ```

---

## Key Files Reference

### Configuration Files
- [app.json](../../app.json) - Expo config with plugins
- [eas.json](../../eas.json) - EAS build profiles
- [metro.config.js](../../metro.config.js) - Metro bundler config
- [tsconfig.json](../../tsconfig.json) - TypeScript config

### Build-Related Files
- [plugins/withLawSourcesAssets.js](../../plugins/withLawSourcesAssets.js) - Gradle plugin for PDF copying
- [.easignore](.easignore) - Files to exclude from EAS upload
- `android/app/build.gradle` - Modified by plugin to add copyLawSources task

### Documentation
- [LOCAL-DEV-SETUP.md](LOCAL-DEV-SETUP.md) - Complete setup guide
- [BUILD-INSTRUCTIONS.md](BUILD-INSTRUCTIONS.md) - Original build guide
- [CURRENT-STATUS.md](../status/CURRENT-STATUS.md) - Project status overview

---

## Next Steps After Setup

### Immediate
1. ‚úÖ Wait for first build to complete
2. ‚úÖ Test app opens and PDFs load
3. ‚úÖ Test AI chat functionality
4. ‚úÖ Test hot reload with simple change

### Development Workflow
```bash
# Each morning:
npx expo start --dev-client

# Throughout the day:
# - Edit code
# - Save
# - Test (2-3 sec hot reload)
# - Commit when done

# Weekly/monthly:
# Build production APK via EAS
npx eas build --profile production --platform android
```

### Optional Enhancements
- Add voice input to chat (@react-native-voice/voice)
- Add text-to-speech (expo-speech)
- Implement conversation history
- Add suggested questions
- Optimize PDF sizes (compression)

---

## Summary

### What Was Set Up
- ‚úÖ Java 21 installed
- ‚úÖ Android SDK configured
- ‚úÖ Environment variables set (ANDROID_HOME, PATH)
- ‚úÖ ADB accessible
- ‚úÖ First local build initiated

### What You Get
- ‚úÖ **Instant hot-reload** (2-3 sec vs 15 min)
- ‚úÖ **Offline development** (no EAS uploads)
- ‚úÖ **Unlimited builds** (no build minute limits)
- ‚úÖ **Faster iteration** (rapid testing)

### Development Speed Improvement
- **Before:** 15-20 min per code change test
- **After:** 2-3 sec per code change test
- **Speed up:** ~300x faster! üöÄ

---

## Commands Quick Reference

```bash
# Daily development
npx expo start --dev-client

# Rebuild if needed (native changes)
npx expo run:android

# Production build (weekly)
npx eas build --profile production --platform android

# Check connected devices
adb devices

# Restart Metro bundler
# Press 'r' in Metro terminal

# Reload app on device
# Shake device ‚Üí "Reload"
# Or press 'r' in Metro

# Clean build cache
cd android && ./gradlew clean && cd ..

# Uninstall app
adb uninstall com.lawpalgy.app
```

---

**Setup completed:** January 1, 2026
**Status:** First build in progress
**Expected completion:** 30-60 minutes from start




